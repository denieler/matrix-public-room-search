<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Matrix Public Rooms | Search and Discover Public Chat Rooms</title>

  <!-- Meta Tags for SEO -->
  <meta name="description" content="Search and discover Matrix.org public rooms. Find and join public chat rooms on the Matrix network.">
  <meta name="keywords" content="Matrix, Matrix.org, public rooms, chat rooms, search, discover, join, communication, messaging">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Matrix Public Rooms">
  <meta property="og:description" content="Search and discover Matrix.org public rooms. Find and join public chat rooms on the Matrix network.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://search-matrix-rooms.denieler.com">
  <meta property="og:image" content="https://search-matrix-rooms.denieler.com/assets/matrix-logo.jpg">

  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Matrix Public Rooms">
  <meta name="twitter:description" content="Search and discover Matrix.org public rooms. Find and join public chat rooms on the Matrix network.">
  <meta name="twitter:image" content="https://search-matrix-rooms.denieler.com/assets/matrix-logo.jpg">

  <style>
    * {
      box-sizing: border-box;
    }
  </style>

  <!-- Structured Data for SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": "Matrix Public Rooms",
    "description": "Search and discover Matrix.org public rooms. Find and join public chat rooms on the Matrix network.",
    "url": "https://search-matrix-rooms.denieler.com/",
    "publisher": {
      "@type": "denieler",
      "name": "denieler",
      "url": "https://search-matrix-rooms.denieler.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://search-matrix-rooms.denieler.com/assets/matrix-logo.jpg"
      }
    }
  }
  </script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- shadcn UI styles -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shadcn/ui@latest/dist/index.min.css" />

  <!-- Favicon -->
  <link rel="icon" href="/assets/favicon.svg" type="image/x-icon">
</head>
<body class="bg-background text-foreground">
  <header class="bg-white container mx-auto py-4 px-4 flex items-center justify-between md:justify-center gap-4">
    <span class="font-semibold text-gray-800 text-lg">Topics:</span>
    <button id="menu-toggle" class="sm:hidden text-gray-600 focus:outline-none">
      <!-- Hamburger Icon -->
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
      </svg>
    </button>
    <nav id="nav-menu" class="hidden sm:flex flex-col sm:flex-row space-x-4">
      <a href="/top/love.html" class="text-gray-400 hover:text-black transition duration-200">Love</a>
      <a href="/top/privacy.html" class="text-gray-400 hover:text-black transition duration-200">Privacy</a>
      <a href="/top/crypto.html" class="text-gray-400 hover:text-black transition duration-200">Crypto</a>
      <a href="/top/gaming.html" class="text-gray-400 hover:text-black transition duration-200">Gaming</a>
      <a href="/top/movies-and-tv-shows.html" class="text-gray-400 hover:text-black transition duration-200">Movies & TV Shows</a>
      <a href="/top/education-research.html" class="text-gray-400 hover:text-black transition duration-200">Education & Research</a>
    </nav>
  </header>
  
  <!-- Mobile Menu Overlay -->
  <div id="mobile-menu" class="fixed py-8 px-4 inset-0 z-50 bg-gray-800 bg-opacity-90 hidden justify-center items-center">
    <nav class="flex flex-col space-y-4 text-white text-xl">
      <a href="/top/love.html" class="hover:text-gray-300">Love</a>
      <a href="/top/privacy.html" class="hover:text-gray-300">Privacy</a>
      <a href="/top/crypto.html" class="hover:text-gray-300">Crypto</a>
      <a href="/top/gaming.html" class="hover:text-gray-300">Gaming</a>
      <a href="/top/movies-and-tv-shows.html" class="hover:text-gray-300">Movies & TV Shows</a>
      <a href="/top/education-research.html" class="hover:text-gray-300">Education & Research</a>
    </nav>
    <button id="close-menu" class="absolute top-4 right-4 text-white">
      <!-- Close Icon -->
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
  
  <script>
    // JavaScript to toggle the mobile menu
    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const closeMenu = document.getElementById('close-menu');
  
    menuToggle.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });
  
    closeMenu.addEventListener('click', () => {
      mobileMenu.classList.add('hidden');
    });
  </script>

  <div class="container mx-auto py-8 px-4">
    <h1 class="scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl mb-6 text-center">Matrix (org) Public Rooms</h1>
    <p class="text-xl text-muted-foreground mb-6 text-center">Welcome to our Matrix Public Rooms directory. Here you can search and discover public chat rooms available on the Matrix network. Join conversations, connect with communities, and explore topics that interest you.</p>
    <div class="mb-4 relative">
      <input type="text" id="search-input" placeholder="Search rooms..." class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" />
      <div class="absolute inset-y-0 right-0 flex items-center justify-center pr-3 pointer-events-none" style="display: none;" id="spinner">
        <svg class="animate-spin h-5 w-5 mt-2 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </div>
    </div>
    <div id="rooms-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Rooms will be loaded here -->
    </div>
  </div>

  <script>
    let roomsData = [];

    // Fetch the rooms data from rooms.json
    fetch('rooms.json')
      .then(response => response.json())
      .then(data => {
        roomsData = data.filter(room => room.num_joined_members >= 5)
            .filter(room =>
              !room.name?.toLowerCase().includes('русск') &&
              !room.name?.toLowerCase().includes('russian') &&
              !room.topic?.toLowerCase().includes('русск')  &&
              !room.topic?.toLowerCase().includes('russian')
            );
        displayRooms(roomsData);
      })
      .catch(error => {
        console.error('Error loading rooms data:', error);
        const container = document.getElementById('rooms-container');
        container.innerHTML = '<p class="text-destructive">Error loading rooms data.</p>';
      });

    function displayRooms(rooms) {
      const container = document.getElementById('rooms-container');
      container.innerHTML = '';

      if (rooms.length === 0) {
        container.innerHTML = '<p class="text-muted-foreground">No rooms found.</p>';
        return;
      }

      rooms.forEach(room => {
        const roomCard = document.createElement('div');
        roomCard.className = 'rounded-lg border bg-card text-card-foreground shadow-sm';

        let avatarImg = getAvatarUrl(room.avatar_url);
        let roomUrl = `https://matrix.to/#/${room.room_id}`;

        roomCard.innerHTML = `
          <div class="p-4">
            <div class="flex items-center space-x-4 mb-4">
              <div class="relative flex-shrink-0 w-10 h-10 rounded-full overflow-hidden bg-secondary">
                ${avatarImg ? `<img src="${avatarImg}" alt="Room Avatar" class="w-full h-full object-cover" onerror="this.onerror=null; this.src='/assets/room-default-icon.svg';">` : ''}
              </div>
              <h3 class="scroll-m-20 text-2xl font-semibold tracking-tight break-all">${room.name || 'Unnamed Room'}</h3>
            </div>
            <div class="flex items-start space-x-1 text-sm text-muted-foreground mb-2">
              <strong class="flex-shrink-0">Room ID:</strong>
              <a href="${roomUrl}" class="text-primary hover:underline overflow-hidden overflow-ellipsis">
                <span class="block truncate">${room.room_id}</span>
              </a>
            </div>
            <p class="text-sm text-muted-foreground mb-2"><strong>Server:</strong> ${room.server}</p>
            <p class="text-sm text-muted-foreground mb-2"><strong>Members:</strong> ${room.num_joined_members}</p>
            <p class="text-sm line-clamp-4">${room.topic || 'No topic available'}</p>
          </div>
        `;

        container.appendChild(roomCard);
      });
    }

    function getAvatarUrl(avatarUrl) {
      if (!avatarUrl) return null;
      const mxcMatch = avatarUrl.match(/^mxc:\/\/([^\/]+)\/(.+)$/);
      if (mxcMatch) {
        const server = mxcMatch[1];
        const mediaId = mxcMatch[2];
        return `https://${server}/_matrix/media/v3/thumbnail/${server}/${mediaId}?width=64&height=64&method=scale`;
      }
      return null;
    }

    function debounce(func, delay) {
      let debounceTimer;
      return function() {
        const context = this;
        const args = arguments;
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => func.apply(context, args), delay);
      }
    }

    let processInput = function() {
      document.getElementById('spinner').style.display = 'inline-block';

      const query = this.value.toLowerCase();
      const filteredRooms = roomsData.filter(room => {
        return (
          (room.name && room.name.toLowerCase().includes(query)) ||
          (room.topic && room.topic.toLowerCase().includes(query)) ||
          (room.server && room.server.toLowerCase().includes(query))
        );
      });

      displayRooms(filteredRooms);

      setTimeout(() => {
        document.getElementById('spinner').style.display = 'none';
      }, 500);
    }

    let debouncedProcessInput = debounce(processInput, 500);
    document.getElementById('search-input').addEventListener('input', debouncedProcessInput);
  </script>
</body>
</html>
